<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>RE Haifa Hub — Документ</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <link rel="icon" href="green.jpg" />
  <meta name="description" content="RE Haifa Hub — документы и знания.">

  <style>
    header .btn {
      display: inline-block;
      padding: 10px 22px;
      margin: 6px;
      border-radius: 30px;
      font-weight: 600;
      text-decoration: none;
      transition: all 0.3s ease;
      background: rgba(255,255,255,0.6);
      border: 2px solid #0a192f;
      color: #0a192f;
    }
    header .btn:hover {
      background: rgba(255,255,255,0.85);
      color: #000;
    }

    body {
      margin:0;
      font-family:Arial,sans-serif;
      background:#f7fafc;
      color:#223;
    }

    header {
      background: rgba(67,160,71,0.85) url('haifa_nof.jpg') center center/cover no-repeat;
      color: #fff;
      padding: 2.5rem 0 2.5rem 0;
      text-align: center;
      position: relative;
      z-index: 1;
    }
    header h1 {
      margin:0 0 0.4em 0;
      font-size:2.7em;
      letter-spacing:2px;
      text-shadow: 0 3px 16px #000c;
      font-weight: bold;
    }
    header p {
      margin:0 0 0.6em 0;
      font-size:1.2em;
      text-shadow: 0 2px 8px #000b;
    }

    .menu-btn {
      position: fixed;
      top: 0px; left: 15px;
      font-size: 1.8em;
      cursor: pointer;
      border: none;
      background: rgba(67,160,71,0.85);
      color: #fff;
      border-radius: 6px;
      padding: 0.2em 0.5em;
      z-index: 1501;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .menu-btn:hover { background: rgba(46,125,50,0.95); }

    .side-menu {
      height: 100%;
      width: 0;
      position: fixed;
      z-index: 1200;
      top: 0;
      left: 0;
      background-color: rgba(67,160,71,0.95);
      overflow-x: hidden;
      transition: 0.3s;
      padding-top: 3rem;
    }
    .side-menu a {
      display: block;
      padding: 0.8em 1.2em;
      text-decoration: none;
      font-size: 1.2em;
      color: #fff;
      transition: background 0.2s;
    }
    .side-menu a:hover { background: rgba(255,255,255,0.2); }

    main {
      max-width:800px;
      margin:2rem auto;
      background:#fff;
      border-radius:12px;
      box-shadow:0 4px 16px rgba(67,160,71,0.25);
      padding:2rem 2.5rem;
      z-index: 0;
      position: relative;
    }

    .md h1, .md h2, .md h3 { color:#223; }
    .md h1 { font-size: 1.8em; margin: 0.2em 0 0.8em 0; }
    .md h2 { font-size: 1.35em; margin: 1.2em 0 0.6em 0; }
    .md h3 { font-size: 1.15em; margin: 1.0em 0 0.5em 0; }
    .md p { line-height: 1.7; margin: 0.7em 0; }
    .md ul, .md ol { margin: 0.7em 0 0.7em 1.2em; }
    .md li { margin: 0.35em 0; }
    .md a { color: #2e7d32; text-decoration: underline; }
    .md a:hover { opacity: 0.85; }
    .md details {
      background: rgba(67,160,71,0.06);
      border: 1.5px solid rgba(67,160,71,0.25);
      border-radius: 10px;
      padding: 0.8em 1em;
      margin: 0.8em 0;
      box-shadow: 0 1px 5px rgba(67,160,71,0.12);
    }
    .md summary {
      cursor: pointer;
      font-weight: 700;
      color: #2e7d32;
      font-size: 1.05em;
    }
    .md table {
      width: 100%;
      border-collapse: collapse;
      margin: 1em 0;
      font-size: 0.98em;
    }
    .md th, .md td {
      border: 1px solid rgba(67,160,71,0.25);
      padding: 0.6em 0.7em;
      vertical-align: top;
    }
    .md th {
      background: rgba(67,160,71,0.10);
      font-weight: 700;
    }

    .top-actions {
      display:flex;
      gap:10px;
      flex-wrap: wrap;
      margin: 0 0 1em 0;
    }
    .pill {
      display:inline-block;
      background: rgba(67,160,71,0.12);
      border: 1px solid rgba(67,160,71,0.35);
      border-radius: 999px;
      padding: 0.5em 0.9em;
      text-decoration: none;
      color:#2e7d32;
      font-weight:700;
    }
    .pill:hover { opacity: 0.85; }

    @media (max-width:600px) {
      header { padding:2em 0 1.2em 0; }
      header h1 { font-size:1.7em; }
      main { padding:1em 0.9em; margin: 1rem auto; }
    }

    footer {
      text-align:center;
      color:#789;
      font-size:0.96em;
      margin:2.5em 0 1em 0;
    }
  </style>
</head>

<body>
  <header>
    <h1>RE Haifa Hub</h1>
    <p>Документы и знания</p>

    <a class="btn fb-link"
       href="https://www.facebook.com/profile.php?id=61575821814765"
       target="_blank" rel="noopener">
      Мы на Facebook
    </a>

    <a class="btn join-link"
       href="https://belanik.github.io/RE-Haifa-Hub/anketa-ru.html"
       target="_blank" rel="noopener">
      Присоединиться к нам
    </a>
  </header>

  <button class="menu-btn" onclick="toggleMenu()">☰</button>

  <div style="text-align: center; margin-top: 10px;">
    <button onclick="location.href='index.html'" class="btn" title="Русская версия">RU</button>
    <button onclick="location.href='english_version/index_en.html'" class="btn" title="English version">EN</button>
    <button onclick="location.href='hebrew_version/index_he.html'" class="btn" title="Hebrew version">HE</button>
  </div>

  <nav id="sideMenu" class="side-menu">
    <a href="index.html">Главная</a>
    <a href="index.html#past-events">Мероприятия</a>
    <a href="about_us.html">Наша команда</a>
    <a href="экоанатилика%20на%20сайт/ecoanalytics-ru.html">Эко-аналитика</a>
    <a href="textbookWM.html">Школа управления отходами</a>
    <a href="eco-law-ru.html">Эко законы Израиля</a>
    <a href="oecd_reports/oecd_reports.html">Полезные ссылки</a>
    <a href="oecd_reports/oecd_reports.html">Доклады ОЭСР</a>
  </nav>

  <main>
    <div class="top-actions">
      <a class="pill" href="javascript:history.back()">← Назад</a>
      <a class="pill" href="strategy.html">К оглавлению стратегии</a>
    </div>

    <div id="content" class="md">Загрузка…</div>
  </main>

  <footer>
    &copy; RE Haifa Hub, 2025 &mdash; Экология, обмен и сообщество в Хайфе
  </footer>

  <script>
    function toggleMenu() {
      const menu = document.getElementById("sideMenu");
      if (menu.style.width === "250px" || menu.style.width === "220px") {
        menu.style.width = "0";
      } else {
        menu.style.width = "250px";
      }
    }

    function getParam(name) {
      const url = new URL(window.location.href);
      return url.searchParams.get(name);
    }

    function stripFrontMatter(md) {
      const trimmed = md.replace(/^\uFEFF/, '');
      if (!trimmed.startsWith('---')) return md;
      const end = trimmed.indexOf('\n---', 3);
      if (end === -1) return md;
      return trimmed.slice(end + '\n---'.length).replace(/^\s+/, '');
    }

    function resolvePath(baseFile, href) {
      if (/^(https?:)?\/\//i.test(href) || href.startsWith('mailto:') || href.startsWith('#')) return href;
      if (href.startsWith('/')) return href.replace(/^\/+/, '');
      const baseDir = baseFile.includes('/') ? baseFile.slice(0, baseFile.lastIndexOf('/') + 1) : '';
      const parts = (baseDir + href).split('/').filter(Boolean);
      const out = [];
      for (const p of parts) {
        if (p === '.') continue;
        if (p === '..') { out.pop(); continue; }
        out.push(p);
      }
      return out.join('/');
    }

    function makeViewerLink(filePath) {
      return 'md.html?file=' + encodeURIComponent(filePath);
    }

    function guessTitleFromMd(md) {
      const m = md.match(/^#\s+(.+)$/m);
      return m ? m[1].trim() : null;
    }

    async function loadAndRenderMd() {
      const rawFile = getParam('file');
      const contentEl = document.getElementById('content');

      if (!rawFile) {
        contentEl.innerHTML = '<h1>Файл не указан</h1><p>Открой страницу с параметром <code>?file=...</code></p>';
        return;
      }

      const file = decodeURIComponent(rawFile);

      let res;
      try {
        res = await fetch(file, { cache: 'no-cache' });
      } catch (e) {
        contentEl.innerHTML = '<h1>Ошибка загрузки</h1><p>Не удалось открыть файл.</p>';
        return;
      }

      if (!res.ok) {
        contentEl.innerHTML = '<h1>Файл не найден</h1><p>Проверь путь: <code>' + file + '</code></p>';
        return;
      }

      const mdText = await res.text();
      const md = stripFrontMatter(mdText);

      const renderer = new marked.Renderer();
      const defaultLink = renderer.link.bind(renderer);

      renderer.link = function(href, title, text) {
        const resolved = resolvePath(file, href || '');
        if ((href || '').toLowerCase().endsWith('.md') || resolved.toLowerCase().endsWith('.md')) {
          return defaultLink(makeViewerLink(resolved), title, text);
        }
        return defaultLink(href, title, text);
      };

      marked.setOptions({ renderer });

      contentEl.innerHTML = marked.parse(md);

      const t = guessTitleFromMd(md);
      document.title = t ? ('RE Haifa Hub — ' + t) : 'RE Haifa Hub — Документ';
    }

    loadAndRenderMd();
  </script>
</body>
</html>
